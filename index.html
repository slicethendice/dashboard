<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PingPong Log Viewer</title>

    <!-- Tailwind and Chart.js from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script defer src="./app.js"></script>
  </head>
  <body class="bg-gray-900 text-gray-200 min-h-screen">
    <div id="pp-viz" class="max-w-screen-xl mx-auto p-6 space-y-8">
      <h1 class="text-3xl font-bold">PingPong Trade Analytics</h1>

      <div class="flex flex-wrap items-center gap-4">
        <input
          type="file"
          id="fileInput"
          accept=".jsonl,.json,.log,.txt"
          class="text-sm text-gray-300 bg-gray-800 border border-gray-700 rounded p-2 file:bg-gray-700 file:text-gray-200 file:border-0 file:rounded file:px-4 file:py-2 file:cursor-pointer"
        />
        <label class="flex items-center gap-2"
          ><input type="checkbox" id="toggleColors" class="text-indigo-600" />
          <span>colorful bars</span></label
        >
        <label class="flex items-center gap-2"
          ><input
            type="checkbox"
            id="hideZero"
            checked
            class="text-indigo-600"
          />
          <span>hide zero-PnL trades</span></label
        >
        <span class="text-gray-400 text-sm"
          >New shape only: <code>buy / poll / sell</code></span
        >
      </div>

      <div class="grid grid-cols-2 md:grid-cols-5 gap-4" id="kpis">
        <div class="bg-gray-800 rounded p-4 shadow">
          <div class="text-gray-400 text-sm">Trades</div>
          <div id="kpi-trades" class="text-xl font-semibold">–</div>
        </div>
        <div class="bg-gray-800 rounded p-4 shadow">
          <div class="text-gray-400 text-sm">Win rate</div>
          <div id="kpi-win" class="text-xl font-semibold">–</div>
        </div>
        <div class="bg-gray-800 rounded p-4 shadow">
          <div class="text-gray-400 text-sm">Total PnL (SOL)</div>
          <div id="kpi-total" class="text-xl font-semibold">–</div>
        </div>
        <div class="bg-gray-800 rounded p-4 shadow">
          <div class="text-gray-400 text-sm">Avg PnL / trade</div>
          <div id="kpi-avg" class="text-xl font-semibold">–</div>
        </div>
        <div class="bg-gray-800 rounded p-4 shadow">
          <div class="text-gray-400 text-sm">P50 / P90 hold (s)</div>
          <div id="kpi-holds" class="text-xl font-semibold">–</div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-xl font-semibold mb-2">Per-cycle PnL</h3>
          <canvas id="pnlBarChart" height="160"></canvas>
        </div>
        <div>
          <h3 class="text-xl font-semibold mb-2">Cumulative PnL</h3>
          <canvas id="pnlCumChart" height="160"></canvas>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-xl font-semibold mb-2">
            Bankroll (derived if missing)
          </h3>
          <canvas id="bankrollChart" height="160"></canvas>
        </div>
        <div>
          <h3 class="text-xl font-semibold mb-2">Hold Time Histogram (s)</h3>
          <canvas id="holdHistChart" height="160"></canvas>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-xl font-semibold mb-2">Entry Slope (bps/s)</h3>
          <canvas id="entrySlopeChart" height="160"></canvas>
        </div>
        <div>
          <h3 class="text-xl font-semibold mb-2">Entry Spread (bps)</h3>
          <canvas id="entrySpreadChart" height="160"></canvas>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-xl font-semibold mb-2">
            Median Spread During Hold (bps)
          </h3>
          <canvas id="medianSpreadChart" height="160"></canvas>
        </div>
        <div>
          <h3 class="text-xl font-semibold mb-2">Edge vs Impact at Sell</h3>
          <canvas id="edgeImpactScatter" height="160"></canvas>
        </div>
      </div>

      <h3 class="text-xl font-semibold">Trades</h3>
      <div class="overflow-x-auto bg-gray-800 rounded-lg shadow">
        <table
          id="tradesTable"
          class="min-w-full divide-y divide-gray-700 text-sm"
        >
          <thead class="bg-gray-700 text-gray-200">
            <tr>
              <th class="px-4 py-2 text-left">Cycle</th>
              <th class="px-4 py-2 text-left">Reason</th>
              <th class="px-4 py-2 text-left">Buy SOL</th>
              <th class="px-4 py-2 text-left">Sell SOL</th>
              <th class="px-4 py-2 text-left">Net PnL</th>
              <th class="px-4 py-2 text-left">ΔPrice %</th>
              <th class="px-4 py-2 text-left">Hold (s)</th>
              <th class="px-4 py-2 text-left">Entry slope</th>
              <th class="px-4 py-2 text-left">Entry spread</th>
              <th class="px-4 py-2 text-left">Bankroll</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700"></tbody>
        </table>
      </div>
    </div>
  </body>
</html>
